<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>è¿½è¹¤è¨‚å–®è©³æƒ…</title>

    <!-- import bootstrap 5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <!-- import font-style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300&display=swap" rel="stylesheet">

    <!-- import jquery-3.6.0 -->
    <script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- import icon -->
    <script src="https://kit.fontawesome.com/b5ef6b60f3.js" crossorigin="anonymous"></script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/qs/6.11.0/qs.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" type="text/css" href="../../resources/static/css/orderDetails.css"/>

    <link rel="stylesheet" type="text/css" href="../../resources/static/css/backendDetail.css"/>
    <style>

        body {
            background-image: url('../asset/img/share_icon/bg.jpg');
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            background-size: cover;
            background-color: rgba(29, 29, 29, 0.8);
            background-blend-mode: multiply;
        }
    </style>
</head>
<body>

<div style="height: 50.6px"></div>
<main>

    <div id="app" class="container" v-cloak>

        <div class="container-xl">
            <div class="table-responsive">
                <div class="table-wrapper">
                    <div class="table-title">
                        <div class="row">
                            <div class="col-sm-4">
                                <h2>å¾Œå° <b>è¨‚å–®è©³æƒ…</b></h2>
                            </div>
                            <div class="col-sm-8">
                                <button @click="refresh()" class="btn btn-primary"><i
                                        class="fa-solid fa-arrows-rotate"></i> <span>Refresh List</span></button>
                                <!--                                <button class="btn btn-secondary"><i class="fa-regular fa-file-excel"></i> <span>Export to Excel</span>-->
                                <!--                                </button>-->
                            </div>
                        </div>
                    </div>
                    <div class="table-filter">
                        <div class="row">
                            <div class="col-sm-3">
                                <!--                                <div class="show-entries">-->
                                <!--                                    <span>Show</span>-->
                                <!--                                    <select class="form-control">-->
                                <!--                                        <option>5</option>-->
                                <!--                                        <option>10</option>-->
                                <!--                                        <option>15</option>-->
                                <!--                                        <option>20</option>-->
                                <!--                                    </select>-->
                                <!--                                    <span>entries</span>-->
                                <!--                                </div>-->
                            </div>
                            <div class="col-sm-9">

                                <div class="filter-group">
                                    <label>è¨‚å–®ç‹€æ…‹</label>
                                    <select class="form-select-sm" @change="filterStatus()"
                                            aria-label="Default select example"
                                            v-model="filterSta">
                                        <option value="" disabled selected>è«‹é¸æ“‡</option>
                                        <option value="0">å¾…ä»˜æ¬¾</option>
                                        <option value="6">å·²å®Œæˆ</option>
                                        <option value="3">é‹è¼¸ä¸­</option>
                                        <option value="2">æº–å‚™å‡ºè²¨ä¸­</option>
                                        <option value="4">å–æ¶ˆå¯©æ ¸ä¸­</option>
                                        <option value="9">è¨‚å–®å·²å–æ¶ˆ</option>
                                        <option value="5">æœªå–è²¨é€€å›</option>
                                        <option value="1">æœªä»˜æ¬¾å–æ¶ˆ</option>
                                        <option value="7">é€€æ›è²¨ç”³è«‹ä¸­</option>
                                        <option value="8">é€€æ›è²¨è™•ç†ä¸­</option>
                                    </select>
                                </div>
                                <span class="filter-icon"><i class="fa fa-filter"></i></span>
                            </div>
                        </div>
                    </div>
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>æ”¶ä»¶äººå§“å</th>
                            <th>è¨‚å–®æˆç«‹æ™‚é–“</th>
                            <th>è¨‚å–®ç‹€æ…‹</th>
                            <th>è¨‚å–®é‡‘é¡</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody v-for="(details, index) in filterStatus" :key="details.ITEM_ID"
                        >
                        <tr>
                            <td>{{ details.ORDER_ID }}</td>
                            <td>{{ details.RECEIVER_NAME }}</td>
                            <!--                            <td>London</td>-->
                            <td>{{ details.ORDER_DATE }}</td>
                            <td>{{ statusFilter(details.ORDER_STATUS) }}</td>
                            <td>NT$ {{ details.FINAL_PRICE }}</td>
                            <td>
                                <button @click="viewDetail(details, index)" class="btn btn-outline-info view"
                                        title="View Details"
                                        data-bs-target="#myModal" data-bs-toggle="modal"
                                        data-toggle="tooltip"><i
                                        class="fa-solid fa-right-long"></i></button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <!--                    <div class="clearfix">-->
                    <!--                        <div class="hint-text">Showing <b>5</b> out of <b>?</b> entries</div>-->
                    <!--                        <ul class="pagination">-->

                    <!--                            <li class="page-item">-->
                    <!--                                <button class="page-link">ä¸Šä¸€é </button>-->
                    <!--                            </li>-->
                    <!--                            <li class="page-item active">-->
                    <!--                                <button class="page-link">page1</button>-->
                    <!--                            </li>-->

                    <!--                            <li class="page-item">-->
                    <!--                                <button class="page-link">ä¸‹ä¸€é </button>-->
                    <!--                            </li>-->
                    <!--                        </ul>-->
                    <!--                    </div>-->
                </div>
            </div>
        </div>

        <!-- é‡å°å€‹åˆ¥è¨‚å–®æ“ä½œä¹‹å½ˆå‡ºè¦–çª— -->
        <div class="py-2">
            <div class="modal modal-lg fade" id="myModal">
                <div class="modal-dialog">
                    <div class="modal-content row d-flex justify-content-center">
                        <div class="modal-header">
                            <h5 class="modal-title">è¨‚å–®è©³æƒ…</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <br>

                        <h4>{{ statusFilter(tmpStatus) }}</h4>
                        <!--  å¾Œå°äººå“¡æ“ä½œè¨‚å–®  -->
                        <div v-if="tmpStatus === '2'"
                             class="d-flex justify-content-end gap-2">
                            <button class="btn btn-outline-success" data-bs-dismiss="modal" aria-label="Close"
                                    @click="startShip()">å®Œæˆå‡ºè²¨
                            </button>
                        </div>
                        <div v-else-if="tmpStatus === '3'"
                             class="d-flex justify-content-end gap-2">
                            <button class="btn btn-outline-success" data-bs-dismiss="modal" aria-label="Close"
                                    @click="startShip()">ä¿®æ”¹ç‰©æµç·¨è™Ÿ
                            </button>
                        </div>

                        <div v-else-if="tmpStatus === '7'"
                             class="d-flex justify-content-end gap-2">
                            <button class="btn btn-outline-success" @click="acceptReturn()">æ¥å—ç”³è«‹</button>
                            <button class="btn btn-outline-danger" @click="rejectReturn()">æ‹’çµ•ç”³è«‹</button>
                        </div>
                        <div v-else-if="tmpStatus === '8'"
                             class="d-flex justify-content-end gap-2">
                            <button class="btn btn-outline-success" data-bs-dismiss="modal" aria-label="Close"
                                    @click="startShip()">å®Œæˆå‡ºè²¨
                            </button>
                        </div>
                        <!-- END -->

                        <strong>è¨‚å–®æ—¥èªŒ</strong>
                        <div class="overflow-auto" style="max-height: 200px;">
                            <p v-html="tmpOther"></p>
                        </div>
                        <hr>
                        <div class="modal-body">
                            <div class="media-body">
                                <div class="container d-flex align-items-center justify-content-between mt-1"
                                     v-for="(detail, index) in detail"
                                     :key="detail.itemId">
                                    <img :src="'data:image/jpeg;base64,' + detail.photo" alt="productImg"
                                         class="img-sm border rounded">
                                    <strong class="font-weight-bold mb-2">{{ detail.itemName }}</strong>
                                    <div class="row">
                                        <small class="font-weight-bold col-md-12 my-2">å–®åƒ¹ NT$ {{
                                                detail.itemPrice
                                            }}</small>
                                        <small class="font-weight-bold col-md-12 my-2">å•†å“æ•¸é‡ {{
                                                detail.cdAmount
                                            }}</small>
                                    </div>
                                </div>
                                <div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>

    </div>
</main>

<!-- import bootstrap 5.2.1 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>


<!-- import vue.js  -->
<script src="https://unpkg.com/vue@3"></script>
<script src="https://unpkg.com/vue-router@4"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>


<!--<script src="../../resources/static/js/listOrderBackend.js"></script>-->
<script>
    let vm = Vue.createApp({
        data() {
            return {
                tmpOrderId: '',
                tmpStatus: '',
                tmpOther: '',
                filterSta: '',
                statusSelect: '',
                details: [],
                detail: []
            }
        },
        beforeCreate() {
            var qs = Qs
            axios.post('/CGA104G1/ListAllOrderBackServlet')
                .then(res => {
                    console.log(res.data);
                    this.details = res.data;
                })
                .catch(err => {
                    console.log(err);
                })
        },
        methods: {
            statusFilter: function (val) {
                switch (val) {
                    case '0':
                        return 'ğŸŸ  ç­‰å¾…ä»˜æ¬¾ä¸­'
                    case '1':
                        return 'âš« æœªå®Œæˆä»˜æ¬¾ï¼Œè¨‚å–®è‡ªå‹•å–æ¶ˆ'
                    case '2':
                        return 'ğŸ”µ å®Œæˆä»˜æ¬¾ï¼Œæº–å‚™å‡ºè²¨ä¸­'
                    case '3':
                        return 'âšª æ­£åœ¨é‹è¼¸é€”ä¸­'
                    case '4':
                        return 'ğŸŸ¥ å–æ¶ˆè¨‚å–®å¯©æ ¸ä¸­'
                    case '5':
                        return 'ğŸŸ¡ æœªå–è²¨ï¼Œé€€å›å¹³å°'
                    case '6':
                        return 'ğŸŸ¢ å·²å®Œæˆå–è²¨'
                    case '7':
                        return 'ğŸŸ¦ é€€/æ›è²¨ç”³è«‹ä¸­'
                    case '8':
                        return 'ğŸ”µ é€€/æ›è²¨è™•ç†ä¸­'
                    default:
                        return 'âš« è¨‚å–®å·²å–æ¶ˆ'

                }
            },
            viewDetail: function (details, index) {
                var qs = Qs
                axios.post('/CGA104G1/MoreDetailsServlet', qs.stringify({
                    orderId: this.details[index].ORDER_ID
                }))
                    .then(res => {
                        console.log(res);
                        this.detail = res.data;
                        this.tmpOther = this.details[index].ORDER_OTHER.replace(/(\r\n)|(\n)/g, '<br>');
                        this.tmpStatus = this.details[index].ORDER_STATUS;
                        this.tmpOrderId = this.details[index].ORDER_ID;
                    })
                    .catch(err => {
                        console.log(err);
                    })
            },
            refresh: function () {
                window.location.reload();
            },
            startShip: async function () {
                const {value: formValues} = await Swal.fire({
                    title: 'è«‹è¼¸å…¥è©²è¨‚å–®ä¹‹ç‰©æµç·¨è™Ÿ',
                    html:
                        '<input id="swal-input1" class="swal2-input">' + '<br>' +
                        '<div style="color: red">é€å‡ºå‰è«‹å†æ¬¡æ ¸å°ç‰©æµç·¨è™Ÿæ˜¯å¦æ­£ç¢º</div>',
                    focusConfirm: false,
                    preConfirm: () => {
                        return document.getElementById('swal-input1').value
                    }
                })
                if (formValues) {
                    var qs = Qs
                    axios.post('/CGA104G1/UpdateOrderServlet', qs.stringify({
                        orderId: this.tmpOrderId, orderOther: formValues, action: "ship"
                    }))
                        .then(res => {
                            console.log(res);
                            window.location.reload()
                        })
                        .catch(err => {
                            console.log(err);
                        })
                    Swal.fire({
                        icon: 'success',
                        title: 'æˆåŠŸæ›´æ–°è¨‚å–®ç‹€æ…‹~',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'è­¦å‘Š',
                        text: 'è«‹è¼¸å…¥è¨‚å–®ä¹‹ç‰©æµç·¨è™Ÿ!',
                    })
                }
            },
            acceptReturn: function () {
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-warning'
                    },
                    buttonsStyling: false
                })

                swalWithBootstrapButtons.fire({
                    title: 'ç¢ºèªæ¥å—é€€/æ›è²¨å—?',
                    text: "è«‹åœ¨å®¢æœäººå“¡å–å¾—è©³ç´°è³‡è¨Šä¸¦å¯©æ ¸å¾Œåœ¨æ¥å—ç”³è«‹",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ç¢ºèªé€å‡º',
                    cancelButtonText: 'å†æ¬¡ç¢ºèª',
                    reverseButtons: true

                }).then((result) => {
                    if (result.isConfirmed) {
                        var qs = Qs;
                        axios.post('/CGA104G1/UpdateOrderServlet', qs.stringify({
                            orderId: this.tmpOrderId, action: 'acceptReturn'
                        }))
                            .then(res => {
                                console.log(res);
                                Swal.fire({
                                    icon: 'success',
                                    title: 'æˆåŠŸæ‰¹æº–å¯©æ ¸',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                                setTimeout(function () {
                                    window.location.reload();
                                }, 2000)
                            })
                            .catch(err => {
                                console.log(err);
                            })
                    } else if (
                        /* Read more about handling dismissals below */
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        swalWithBootstrapButtons.fire(
                            'å°šæœªæ‰¹å‡†å¯©æ ¸',
                            'æ‚¨çš„æ“ä½œå°‡å½±éŸ¿å…¬å¸åˆ©ç›Šï¼Œæ‰€ä»¥æœ¬ç³»çµ±çš†æœƒæœ‰è©³ç´°ç´€éŒ„ :)',
                            'warning'
                        )
                    }
                })
            }, rejectReturn: function () {
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-warning'
                    },
                    buttonsStyling: false
                })

                swalWithBootstrapButtons.fire({
                    title: 'ç¢ºèªæ‹’çµ•é€€/æ›è²¨å—?',
                    text: "è«‹åœ¨å®¢æœäººå“¡å–å¾—è©³ç´°è³‡è¨Šä¸¦å¯©æ ¸å¾Œåœ¨æ‹’çµ•ç”³è«‹",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ç¢ºèªé€å‡º',
                    cancelButtonText: 'å†æ¬¡ç¢ºèª',
                    reverseButtons: true

                }).then((result) => {
                    if (result.isConfirmed) {
                        var qs = Qs;
                        axios.post('/CGA104G1/UpdateOrderServlet', qs.stringify({
                            orderId: this.tmpOrderId, action: 'rejectReturn'
                        }))
                            .then(res => {
                                console.log(res);
                                Swal.fire({
                                    icon: 'success',
                                    title: 'æˆåŠŸæ‹’çµ•å¯©æ ¸',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                                setTimeout(function () {
                                    window.location.reload();
                                }, 2000)
                            })
                            .catch(err => {
                                console.log(err);
                            })
                    } else if (
                        /* Read more about handling dismissals below */
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        swalWithBootstrapButtons.fire(
                            'å°šæœªæ‰¹å‡†å¯©æ ¸',
                            'æ‚¨çš„æ“ä½œå°‡å½±éŸ¿å…¬å¸åˆ©ç›Šï¼Œæ‰€ä»¥æœ¬ç³»çµ±çš†æœƒæœ‰è©³ç´°ç´€éŒ„ :)',
                            'warning'
                        )
                    }
                })
            }
        },
        computed: {
            filterStatus() {
                return this.details.filter(result => result.ORDER_STATUS.match(this.filterSta))
            },
            totalReturnTask() {
            }
        }
    });

    vm.mount('#app')

</script>
</body>

<!--  NavBar  -->
<script src="../../resources/static/js/backNavbar.js"></script>

</html>
